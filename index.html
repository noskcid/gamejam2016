<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Immortals</title>
	<style>
		canvas {
			display: block;
			padding-left: 0;
			padding-right: 0;
			margin-left: auto;
			margin-right: auto;
			float: left;
		}

		body {
			margin: 0;
			background-image: url("images/olympus.jpg");
		}

		#game_area {
			display: block;
			margin-left: 0;
			margin-right: 0;
			width: 100%;
		}

		#bottom {
			overflow: hidden;
			padding: 50px 50px 50px 50px;
			background-color: #6f97af;
			opacity: 0.7;
		}

		#metrics {
			float: left;
			width: 50%;
		}

		#control {
			float: right;
			width: 50%;
		}

		ol.name-value {
    		list-style: none;
    		display: table;
		}

		ol.name-value li {
    		display: table-row;
    		border-bottom: 1px solid #E8E8E8;
		}

		ol.name-value li label {
    		display: table-cell;
    		width: 50%; 
		}

		ol.name-value li span {
    		display: table-cell;
    		width: 50%; 
		}
	</style>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script src="js/engine.js"></script>
	<script type="text/javascript">
		farming = 0;
		fishing = 0;
		available = 10;
		var available = 3;
		
		var yellowGradient;

		var canvas;
		var context;
		var canvasW;
		var canvasH;
		var centerX;
		var centerY;
		var cupid_img;
		var church_tracker = 0;
		var church_img;
		var farm_tracker = 0;
		var farm_img;
		var alcohol_tracker = 0;
		var alcohol_img;
		var apoth_tracker = 0;
		var apoth_img;
		var raid_tracker = 0;
		var raid_img;
		var stone_img;
		var wood_img;
		
		
		var god_mouseover = 0;
		var background_audio;
		var mine_audio;

		function loadImages() {
			cupid_img = new Image();
			cupid_img.src = "images/gods/resized/cupid_cropped.jpg";
			loki_img = new Image();
			loki_img.src = "images/gods/resized/loki_cropped.jpg";
			hades_img = new Image();
			hades_img.src = "images/gods/resized/hades_cropped.jpg";
			thor_img = new Image();
			thor_img.src = "images/gods/resized/thor_cropped.jpg";
			athena_img = new Image();
			athena_img.src = "images/gods/resized/athena_cropped.jpg";

			tile_img = new Image();
			tile_img.src = "images/tile.png";
			
			church_img = new Array();
			church_img[0] = new Image();
			church_img[0].src = "images/workingfolder/praise/churchclear.png";
			church_img[1] = new Image();
			church_img[1].src = "images/workingfolder/praise/s1.png";
			church_img[2] = new Image();
			church_img[2].src = "images/workingfolder/praise/s2.png";
			church_img[3] = new Image();
			church_img[3].src = "images/workingfolder/praise/s3.png";
			church_img[4] = new Image();
			church_img[4].src = "images/workingfolder/praise/s4.png";
			church_img[5] = new Image();
			church_img[5].src = "images/workingfolder/praise/s5.png";
			
			farm_img = new Array();
			farm_img[0] = new Image();
			farm_img[0].src = "images/workingfolder/farm/s12.png";
			farm_img[1] = new Image();
			farm_img[1].src = "images/workingfolder/farm/s0.png";
			farm_img[2] = new Image();
			farm_img[2].src = "images/workingfolder/farm/s1.png";
			farm_img[3] = new Image();
			farm_img[3].src = "images/workingfolder/farm/s2.png";
			farm_img[4] = new Image();
			farm_img[4].src = "images/workingfolder/farm/s3.png";
			farm_img[5] = new Image();
			farm_img[5].src = "images/workingfolder/farm/s4.png";
			farm_img[6] = new Image();
			farm_img[6].src = "images/workingfolder/farm/s6.png";
			farm_img[7] = new Image();
			farm_img[7].src = "images/workingfolder/farm/s9.png";
			farm_img[8] = new Image();
			farm_img[8].src = "images/workingfolder/farm/s11.png";

			alcohol_img = new Array();
			alcohol_img[0] = new Image();
			alcohol_img[0].src = "images/workingfolder/alcohol/aclear.png";
			alcohol_img[1] = new Image();
			alcohol_img[1].src = "images/workingfolder/alcohol/a0.png";
			alcohol_img[2] = new Image();
			alcohol_img[2].src = "images/workingfolder/alcohol/a1.png";
			alcohol_img[3] = new Image();
			alcohol_img[3].src = "images/workingfolder/alcohol/a2.png";
			
			apoth_img = new Array();
			apoth_img[0] = new Image();
			apoth_img[0].src = "images/workingfolder/apoth/apothempty.png";
			apoth_img[1] = new Image();
			apoth_img[1].src = "images/workingfolder/apoth/a0.png";
			apoth_img[2] = new Image();
			apoth_img[2].src = "images/workingfolder/apoth/a1.png";
			apoth_img[3] = new Image();
			apoth_img[3].src = "images/workingfolder/apoth/a2.png";
			apoth_img[4] = new Image();
			apoth_img[4].src = "images/workingfolder/apoth/a3.png";
			apoth_img[5] = new Image();
			apoth_img[5].src = "images/workingfolder/apoth/a4.png";

			raid_img = new Array();
			raid_img[0] = new Image();
			raid_img[0].src = "images/tile.png";
			raid_img[1] = new Image();
			raid_img[1].src = "images/workingfolder/raid/r0.png";
			raid_img[2] = new Image();
			raid_img[2].src = "images/workingfolder/raid/r1.png";
			raid_img[3] = new Image();
			raid_img[3].src = "images/workingfolder/raid/r2.png";
			
			stone_img = new Array();
			stone_img[0] = new Image();
			stone_img[0].src = "images/workingfolder/Stone/s0.png";
			stone_img[1] = new Image();
			stone_img[1].src = "images/workingfolder/Stone/s1.png";
			stone_img[2] = new Image();
			stone_img[2].src = "images/workingfolder/Stone/s2.png";

			wood_img = new Array();
			wood_img[0] = new Image();
			wood_img[0].src = "images/workingfolder/wood/0/w0.png";
			wood_img[1] = new Image();
			wood_img[1].src = "images/workingfolder/wood/0/w1.png";
			wood_img[2] = new Image();
			wood_img[2].src = "images/workingfolder/wood/0/w2.png";

		}

		function loadAudio() {
			background_audio = new Audio('Audio/folkloop.mp3');
			/*
			background_audio.addEventListener('ended', function() {
    			this.currentTime = 0;
    			this.play();
			}, false);
			*/
			background_audio.loop = true;
			background_audio.volume = 0.5
			background_audio.play();

			mine_audio = new Audio('Audio/Toby - Oggs/DownTheMinesIGo.ogg');
		}

		function playClip(audio) {
			audio.currentTime = 0;
			audio.play();
		}
		
		function redraw() {
			$("#p_death").text(p_death);
			$("#p_birth").text(p_birth);
			$("#p_healing").text(p_healing);
			$("#p_peace").text(p_peace);
			$("#p_war").text(p_war);
			$("#p_construction").text(p_construction);
			$("#p_destruction").text(p_destruction);
			$("#p_honor").text(p_honor);
			$("#p_mischief").text(p_mischief);

			$("#r_wood").text(r_wood);
			$("#r_stone").text(r_stone);
			$("#r_food").text(r_food);

			$("#pop").text(population);
			$("#year").text(year);



		}

		function drawGod(ct, img, x, y, r) {
			var pattern = ct.createPattern(img, 'repeat');
			ct.beginPath();
      		ct.arc(x, y, r, 0, 2 * Math.PI, false);
      		ct.fillStyle = pattern;
      		ct.fill();
      		ct.lineWidth = 5;
			if (god_mouseover == 0) {
      			ct.strokeStyle = '#6f97af';
			} else {
				ct.strokeStyle = '#000000';
			}
      		ct.stroke();

			ct.beginPath();
      		ct.arc(x+r*0.8, y+r*0.8, r/3, 0, 2 * Math.PI, false);
      		ct.fillStyle = yellowGradient;
      		ct.fill();
      		ct.lineWidth = 4;
      		ct.strokeStyle = '#6f97af';
      		ct.stroke();
			
			ct.fillStyle = '#000000';
			ct.font = "16px Arial";
			ct.fillText("+0",x+r*0.8-6,y+r*0.8+5);

		}

		function mouse(e) {
			var rect = canvas.getBoundingClientRect();
			var x = e.clientX - rect.left;
			var y = e.clientY - rect.top;

			if (y < 110) {
				god_mouseover = 1;
			} else {
				god_mouseover = 0;
			}
			drawGodBar();

		}

		function drawTiles() {
			context.clearRect(0, 115, canvasW, canvasH);
			house_w = 178;
			house_h = 99;
			//context.drawImage(house_img, centerX-(house_w/2), centerY-(house_h/2));
			
			tile_w = 150;
			tile_h = 80;
			tiles_x = 3;
			tiles_y = 3;
			
			
			if (j_worship > 0) {
				church_tracker = (church_tracker + 1) % church_img.length;
				if (church_tracker == 0) {
					church_tracker++;
				}
			} 
			else {
				church_tracker = 0;
			}
			context.drawImage(church_img[church_tracker], centerX-tile_w/2, centerY-3*tile_h/2);
			
			if (j_farmer > 0) {
				farm_tracker = (farm_tracker + 1) % farm_img.length;
			}
			else {
				farm_tracker = 0;
			}
			context.drawImage(farm_img[farm_tracker], centerX-2*tile_w/2, centerY-tile_h);
			
			if (j_brewery > 0) {
				alcohol_tracker = (alcohol_tracker + 1) % alcohol_img.length;
				if (alcohol_tracker == 0) {
					alcohol_tracker++;
				}
			}
			else {
				alcohol_tracker = 0;
			}
			context.drawImage(alcohol_img[alcohol_tracker], centerX, centerY-tile_h);

			context.drawImage(tile_img, centerX-3*tile_w/2, centerY-tile_h/2);
			
			if (j_apothecary > 0) {
				apoth_tracker = (apoth_tracker + 1) % apoth_img.length;
				if (apoth_tracker == 0) {
					apoth_tracker++;
				}
			}
			else {
				apoth_tracker = 0;
			}
			context.drawImage(apoth_img[apoth_tracker], centerX-tile_w/2, centerY-tile_h/2);
			
			context.drawImage(tile_img, centerX+tile_w/2, centerY-tile_h/2);

			if (j_raid > 0) {
				raid_tracker = (raid_tracker + 1) % raid_img.length;
				if (raid_tracker == 0) {
					raid_tracker++;
				}
			}
			else {
				raid_tracker = 0;
			}
			context.drawImage(raid_img[raid_tracker], centerX-2*tile_w/2, centerY);
			
			if (r_wood < 1) {
				context.drawImage(tile_img, centerX, centerY);
			}
			else if (r_wood < 2) {
				context.drawImage(wood_img[0], centerX, centerY);
			}
			else if (r_wood < 3) {
				context.drawImage(wood_img[1], centerX, centerY);
			}
			else {
				context.drawImage(wood_img[2], centerX, centerY);
			}
			
			if (r_stone < 1) {
				context.drawImage(tile_img, centerX-tile_w/2, centerY+tile_h/2);
			}
			else if (r_stone < 2) {
				context.drawImage(stone_img[0], centerX-tile_w/2, centerY+tile_h/2);
			}
			else if (r_stone < 3) {
				context.drawImage(stone_img[1], centerX-tile_w/2, centerY+tile_h/2);
			}
			else {
				context.drawImage(stone_img[2], centerX-tile_w/2, centerY+tile_h/2);
			}

			
			//var pattern = context.createPattern(cupid_img, 'no-repeat');
			

			/*
			context.beginPath();
      		context.arc(100, 100, 100, 0, 2 * Math.PI, false);
      		context.fillStyle = pattern;
      		context.fill();
      		context.lineWidth = 2;
      		context.strokeStyle = '#000000';
      		context.stroke();

			context.drawImage(cupid_img2, 200,100);
			*/

			/*
			context.save();
    		context.beginPath();
    		context.arc(25, 25, 25, 0, Math.PI * 2, true);
    		context.closePath();
    		context.clip();

    		context.drawImage(cupid_img, 0, 0, 50, 50);

    		context.beginPath();
    		context.arc(0, 0, 25, 0, Math.PI * 2, true);
    		context.clip();
    		context.closePath();
    		context.restore();
			*/

		}
		
		function drawGodBar() {
			context.clearRect(0, 0, canvasW, 110);
			drawGod(context,cupid_img,55,55,50);
			drawGod(context,loki_img,155,55,50);
			drawGod(context,hades_img,255,55,50);
			drawGod(context,thor_img,355,55,50);
			drawGod(context,athena_img,455,55,50);
		}
		
		loadImages();
		loadAudio();

		$(document).ready(function () {
			canvas = document.getElementById('game');
			context = canvas.getContext("2d");
			canvasW = 1000;
			canvasH = 700;
			centerX = canvasW / 2;
      		centerY = canvasH / 2;
			
			/*
			var img = new Image();
			img.onload = function () {
    			context.drawImage(img, centerX-(178/2), centerY-(99/2));
			}
			img.src = "images/house.png";
			*/

			// Create fill gradient
			/*
			*/
			yellowGradient = context.createLinearGradient(0, 0, 0, 5);
			yellowGradient.addColorStop(0, "#ffc821");
			yellowGradient.addColorStop(1, "#faf100");

			/*
			context.beginPath();
      		context.arc(15, 15, 10, 0, 2 * Math.PI, false);
      		context.fillStyle = gradient;
      		context.fill();
      		context.lineWidth = 2;
      		context.strokeStyle = '#000000';
      		context.stroke();


			var thumbImg = new Image();
			thumbImg.src = "images/gods/resized/cupid_cropped.jpg";
			thumbImg.onload = function() {
    			//tmpCtx.save();
    			//tmpCtx.beginPath();
    			//tmpCtx.arc(25, 25, 25, 0, Math.PI * 2, true);
    			//tmpCtx.closePath();
    			//tmpCtx.clip();

    			context.drawImage(thumbImg, 0, 0, 100, 100);

    			//tmpCtx.beginPath();
    			//tmpCtx.arc(0, 0, 25, 0, Math.PI * 2, true);
    			//tmpCtx.clip();
    			//tmpCtx.closePath();
    			//tmpCtx.restore();
			};
			*/
			window.addEventListener('mousemove',mouse, false);
			// Grid height correction for Colour
			//$("#colour").height($("#rain").height());

			// Update every minute
			interval = setInterval(function(){
				update();
				redraw();
			}, 1000);
			
			tileInterval = setInterval(function(){
				drawTiles();
			}, 200);

			$('input.plus').click(function (event) {
				if (available > 0) {
					if (event.target.id == 'brewery') {
						j_brewery += 0.1;
						$("#j_brewery").text(j_brewery);	
					}
					else if (event.target.id == 'apothecary') {
						j_apothecary += 0.1;
						$("#j_apothecary").text(j_apothecary);
					}
					else if (event.target.id == 'raid') {
						j_raid += 0.1;
						$("#j_raid").text(j_raid);
					}
					else if (event.target.id == 'worship') {
						j_worship += 0.1;
						$("#j_worship").text(j_worship);
					}
					else if (event.target.id == 'woodcutter') {
						j_woodcutter += 0.1;
						$("#j_woodcutter").text(j_woodcutter);
					}
					else if (event.target.id == 'stoneMason') {
						playClip(mine_audio);
						j_stoneMason += 0.1;
						$("#j_stoneMason").text(j_stoneMason);
					}
					else if (event.target.id == 'farmer') {
						j_farmer += 0.1;
						$("#j_farmer").text(j_farmer);
					}
					available -= 1;
				}
			});

			$('input.minus').click(function (event) {
				if (event.target.id == 'brewery') {
					if (j_brewery > 0) {
						j_brewery -= 0.1;
						$("#j_brewery").text(j_brewery);
						available += 1;
					}	
				}
				else if (event.target.id == 'apothecary') {
					if (j_apothecary > 0) {
						j_apothecary -= 0.1;
						$("#j_apothecary").text(j_apothecary);
						available += 1;
					}
				}
				else if (event.target.id == 'raid') {
					if (j_raid > 0) {
						j_raid -= 0.1;
						$("#j_raid").text(j_raid);
						available += 1;
					}
				}
				else if (event.target.id == 'worship') {
					if (j_worship > 0) {
						j_worship -= 0.1;
						$("#j_worship").text(j_worship);
						available += 1;
					}
				}
				else if (event.target.id == 'woodcutter') {
					if (j_woodcutter > 0) {
						j_woodcutter -= 0.1;
						$("#j_woodcutter").text(j_woodcutter);
						available += 1;
					}
				}
				else if (event.target.id == 'stoneMason') {
					if (j_stoneMason > 0) {
						j_stoneMason -= 0.1;
						$("#j_stoneMason").text(j_stoneMason);
						available += 1;
					}
				}
				else if (event.target.id == 'farmer') {
					if (j_farmer > 0) {
						j_farmer -= 0.1;
						$("#j_farmer").text(j_farmer);
						available += 1;
					}
				}

			});
		
		});

		function resize() {
			console.log("RESIZE");
			var C = 1;
			var W_TO_H = 2.5/1;

			var viewportWidth = window.innerWidth;
			var viewportHeight = window.innerHeight;
			var canvasWidth = viewportWidth * C;
			var canvasHeight = canvasWidth / W_TO_H;
			canvas.setAttribute("width", canvasWidth);
			canvas.setAttribute("height", canvasHeight);
			drawGodBar();
			drawTiles();
		}

		$(window).on("load", function() {
    		console.log("All images loaded");
			resize();
			drawGodBar();
			drawTiles();
		});
		$(window).on("resize", function() {
			resize();
		});

		
	</script>
    </head>
    <body>
	<div id="game_area">
	Year: <span id="year"></span> Population: <span id="pop"></span>
	<canvas id="game" width="1000px" height="700px"></canvas>
	<div id="bottom">
	<div id="metrics">
	<h3>Parameters</h3>
	<ol class="name-value" style="width: 100%;">
		<li>
			<label for="p_death">Death</label>
			<span id="p_death">0</span>
		</li>
		<li>
			<label for="p_birth">Birth</label>
			<span id="p_birth">0</span>
		</li>
		<li>
			<label for="p_healing">Healing</label>
			<span id="p_healing">0</span>
		</li>
		<li>
			<label for="p_peace">Peace</label>
			<span id="p_peace">0</span>
		</li>
		<li>
			<label for="p_war">War</label>
			<span id="p_war">0</span>
		</li>
		<li>
			<label for="p_construction">Construction</label>
			<span id="p_construction">0</span>
		</li>
		<li>
			<label for="p_destruction">Destruction</label>
			<span id="p_destruction">0</span>
		</li>
		<li>
			<label for="p_honor">Honour</label>
			<span id="p_honor">0</span>
		</li>
		<li>
			<label for="p_mischief">Mischief</label>
			<span id="p_mischief">0</span>
		</li>
	</ol>
	<h3>Resources</h3>
	<ol class="name-value" style="width: 100%;">
		<li>
			<label for="r_wood">Wood</label>
			<span id="r_wood">0</span>
		</li>
		<li>
			<label for="r_stone">Stone</label>
			<span id="r_stone">0</span>
		</li>
		<li>
			<label for="r_food">Food</label>
			<span id="r_food">0</span>
		</li>


	</ol>
	</div>

	<div id="control">
	<h3>Jobs</h3>
	<p>
		Brewery: 
		<input class="plus" id="brewery" type="submit" value="+">
		<span id="j_brewery">0</span>
		<input class="minus" id="brewery" type="submit" value="-">
	</p>
	<p>
		Apothecary: 
		<input class="plus" id="apothecary" type="submit" value="+">
		<span id="j_apothecary">0</span>
		<input class="minus" id="apothecary" type="submit" value="-">
	</p>
	<p>
		Raid: 
		<input class="plus" id="raid" type="submit" value="+">
		<span id="j_raid">0</span>
		<input class="minus" id="raid" type="submit" value="-">
	</p>
	<p>
		Worship: 
		<input class="plus" id="worship" type="submit" value="+">
		<span id="j_worship">0</span>
		<input class="minus" id="worship" type="submit" value="-">
	</p>
	<p>
		Woodcutter: 
		<input class="plus" id="woodcutter" type="submit" value="+">
		<span id="j_woodcutter">0</span>
		<input class="minus" id="woodcutter" type="submit" value="-">
	</p>
	<p>
		Stone Mason: 
		<input class="plus" id="stoneMason" type="submit" value="+">
		<span id="j_stoneMason">0</span>
		<input class="minus" id="stoneMason" type="submit" value="-">
	</p>
	<p>
		Farmer: 
		<input class="plus" id="farmer" type="submit" value="+">
		<span id="j_farmer">0</span>
		<input class="minus" id="farmer" type="submit" value="-">
	</p>

	</div>
	</div>
	</div>
	</body>
</html>
